/**
 * Code Block Styles
 * 
 * Styles for code blocks in both basic and Shiki modes.
 * Reference: astro-paper/src/styles/typography.css
 * 
 * Requirements: 2.4, 9.1, 3.5, 3.6, 4.3, 5.1, 5.2, 5.3, 5.4
 */

@layer base {
  /* ===== Basic Mode Code Blocks ===== */

  /* Code block wrapper */
  .code-block-wrapper {
    @apply relative my-6;
  }

  /* File name label - 复刻 AstroPaper 的文件名标签样式 */
  .code-file-name {
    @apply absolute left-2 -top-3 z-10 inline-flex items-center gap-2 rounded-md border border-border bg-background px-3 py-1 text-xs font-mono;
  }

  .file-indicator {
    @apply inline-block h-1 w-1 rounded-full bg-green-500;
  }

  .file-path {
    @apply text-foreground;
  }

  /* Code block container */
  .code-block {
    @apply relative overflow-hidden rounded-lg border border-border bg-muted/10;
  }

  /* Hover effect for copy button visibility */
  .code-block-wrapper:hover .code-copy-button {
    @apply opacity-100;
  }

  /* Copy button - 复刻 AstroPaper 的复制按钮样式 */
  .code-copy-button {
    @apply absolute right-2 top-2 z-10 flex items-center gap-1.5 rounded-md border border-border bg-background px-2.5 py-1.5 text-xs text-foreground opacity-0 transition-all hover:bg-accent hover:text-white focus-visible:opacity-100;
  }

  .code-copy-button.copied {
    @apply bg-green-500 text-white;
  }

  .code-copy-button .copy-icon {
    @apply h-4 w-4;
  }

  /* Code content */
  .code-content {
    @apply overflow-x-auto p-4;
  }

  /* Chroma syntax highlighting overrides */
  .code-content pre {
    @apply m-0 bg-transparent;
  }

  .code-content code {
    @apply block font-mono text-sm leading-relaxed;
  }

  /* Dark mode adjustments */
  html[data-theme="dark"] .code-file-name {
    @apply bg-background border-border;
  }

  html[data-theme="dark"] .code-block {
    @apply bg-muted/20;
  }

  /* ===== Shiki Mode Code Blocks ===== */

  /* 完全复刻 AstroPaper 的 .astro-code 样式 */

  /* 
   * Shiki 在配置 themes: { light: "min-light", dark: "night-owl" } 
   * 和 defaultColor: false 时会自动生成这些 CSS 变量：
   * - --shiki-light-bg, --shiki-light (浅色主题)
   * - --shiki-dark-bg, --shiki-dark (深色主题)
   * 
   * 参考: astro-paper/astro.config.ts 的 markdown.shikiConfig
   * 参考: astro-paper/src/styles/typography.css 的深色模式样式
   */

  /* Shiki 容器样式 - 对应 AstroPaper 的 flex, border, bg */
  .shiki,
  .astro-code {
    @apply flex border border-border outline-border rounded-lg overflow-x-auto p-4 my-6;

    background-color: var(--shiki-light-bg);
    color: var(--shiki-light);
  }

  /* Shiki 代码内容 - 对应 AstroPaper 的 flex-[1_0_100%] bg-inherit p-0 */
  .shiki code,
  .astro-code code {
    @apply flex-[1_0_100%] bg-inherit p-0 block font-mono text-sm leading-relaxed;
  }

  /* Shiki span 元素颜色 */
  .shiki span,
  .astro-code span {
    color: var(--shiki-light);
  }

  /* ===== 深色模式支持 ===== */

  html[data-theme="dark"] .shiki,
  html[data-theme="dark"] .astro-code {
    background-color: var(--shiki-dark-bg);
    color: var(--shiki-dark);
  }

  html[data-theme="dark"] .shiki span,
  html[data-theme="dark"] .astro-code span {
    color: var(--shiki-dark);
  }

  /* ===== Shiki Transformers 样式 ===== */

  /* 完全复刻 AstroPaper 的差异高亮和行高亮样式 */

  /* 参考: astro-paper/src/styles/typography.css */

  /* 差异高亮 - 添加行 (bg-green-400/20, before:content-['+']) */
  .shiki .line.diff.add,
  .astro-code .line.diff.add {
    @apply relative inline-block w-full bg-green-400/20 before:absolute before:-left-3 before:text-green-500 before:content-['+'];
  }

  /* 差异高亮 - 删除行 (bg-red-500/20, before:content-['-']) */
  .shiki .line.diff.remove,
  .astro-code .line.diff.remove {
    @apply relative inline-block w-full bg-red-500/20 before:absolute before:-left-3 before:text-red-500 before:content-['-'];
  }

  /* 行高亮 (bg-slate-400/20) */
  .shiki .line.highlighted,
  .astro-code .line.highlighted {
    @apply inline-block w-full bg-slate-400/20;
  }

  /* 词高亮 */
  .shiki .highlighted-word,
  .astro-code .highlighted-word {
    @apply rounded-sm border border-border px-0.5 py-px;
  }

  /* ===== 深色模式下的差异和高亮颜色调整 ===== */

  /* 
   * 注意：AstroPaper 没有为深色模式单独调整差异和高亮颜色
   * 
   * 原因：
   * 1. Shiki 的主题切换会自动处理代码的语法高亮颜色
   * 2. 差异标记（green-400/20, red-500/20）和行高亮（slate-400/20）
   *    使用的是半透明颜色，在深色模式下也能保持良好的对比度
   * 3. 保持与 AstroPaper 完全一致的行为
   * 
   * 如果未来需要调整深色模式下的颜色，可以在这里添加：
   * 
   * html[data-theme="dark"] .astro-code .line.diff.add {
   *   @apply bg-green-500/30;
   * }
   * 
   * html[data-theme="dark"] .astro-code .line.diff.remove {
   *   @apply bg-red-600/30;
   * }
   * 
   * html[data-theme="dark"] .astro-code .line.highlighted {
   *   @apply bg-slate-500/30;
   * }
   */
}